# Railway Configuration for Synthora Backend
# ============================================
# This file configures how Railway builds and deploys the backend service.

[build]
# Use Dockerfile builder to avoid Nixpacks PEP 668 issues
builder = "dockerfile"
dockerfilePath = "Dockerfile"

[deploy]
# Start command - run migrations then start FastAPI with verbose output
startCommand = "python -m alembic upgrade head && echo 'Migrations complete, starting uvicorn on port '$PORT && python -c 'from app.main import app; print(\"App imported successfully\")' && uvicorn app.main:app --host 0.0.0.0 --port $PORT --log-level info"

# Health check endpoint - use root /health for faster response
healthcheckPath = "/health"
healthcheckTimeout = 120

# Number of replicas
numReplicas = 1

# Restart policy
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
